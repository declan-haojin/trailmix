default:
  image: node:20.11.1

stages:
  - deploy

deploy_server:
  stage: deploy
  script:
    - cd server
    - export VERCEL_PROJECT_ID=$VERCEL_PROJECT_ID_CLIENT
    - echo "SERVER_PROJECT_ID $VERCEL_PROJECT_ID"
    - npm install --global vercel
    - vercel deploy --prod --token=$VERCEL_TOKEN
  only:
    - master

deploy_client:
  stage: deploy
  script:
    - cd client
    - export VERCEL_PROJECT_ID=$VERCEL_PROJECT_ID_CLIENT
    - echo "CLIENT_PROJECT_ID $VERCEL_PROJECT_ID"
    - npm install --global vercel
    - vercel deploy --prod --token=$VERCEL_TOKEN
  only:
    - master

preview_server:
  stage: deploy
  script:
    - cd server
    - export VERCEL_PROJECT_ID=$VERCEL_PROJECT_ID_CLIENT
    - echo "SERVER_PROJECT_ID $VERCEL_PROJECT_ID"
    - npm install --global vercel
    - vercel deploy --token=$VERCEL_TOKEN
  except:
    - master

preview_client:
  stage: deploy
  script:
    - cd client
    - export VERCEL_PROJECT_ID=$VERCEL_PROJECT_ID_CLIENT
    - echo "CLIENT_PROJECT_ID $VERCEL_PROJECT_ID"
    - npm install --global vercel
    - vercel deploy --token=$VERCEL_TOKEN
  except:
    - master